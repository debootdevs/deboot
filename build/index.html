<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://debootdevs.github.io/deboot/build/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Building DeBoot - DeBoot</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Building DeBoot";
        var mkdocs_page_input_path = "build.md";
        var mkdocs_page_url = "/deboot/build/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> DeBoot
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../overview/">Overview</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../booting/">How booting works</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../deboot/">How DeBoot works</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Boot Stages</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../metal/">Metal</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../uefi/">UEFI</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../grub/">GRUB</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../u-boot/">U-Boot</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../initramfs/">Initramfs</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Using DeBoot</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Building DeBoot</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#quickstart">Quickstart</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#build-container">Build container</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#privileges">Privileges</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#version-consistency">Version consistency</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#layout">Layout</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../debooting/">DeBooting</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../appliance/">Appliances</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../gotcha/">Gotchas</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../inspect/">Inspecting boot images</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">DeBoot</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">Using DeBoot</li>
      <li class="breadcrumb-item active">Building DeBoot</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="building-the-deboot-poc">Building the DeBoot POC</h1>
<p>These instructions are based on the <a href="https://github.com/debootdevs/deboot">deboot repo on github</a>.</p>
<h2 id="quickstart">Quickstart</h2>
<p>Requires <code>podman</code>, <code>git</code>, <code>make</code>, <code>slirp4netns</code>, <code>uidmap</code> (for Debian distributions).</p>
<p>Clone the repo with the <code>--recurse-submodules</code> flag, e.g. with:</p>
<pre><code class="language-sh">git clone https://github.com/debootdevs/deboot.git --recurse-submodules
</code></pre>
<p>Then starting from the repo root, run the following commands:</p>
<pre><code class="language-sh">sudo make init-env
cd /deboot
make BEE_VERSION=$VERSION install
</code></pre>
<p>where <code>$VERSION</code> should be set to the latest version of the Swarm bee node as indicated by its git tag e.g. <code>VERSION=1.18.2</code>.</p>
<p>The main build artefacts are:</p>
<pre><code class="language-sh">./build/boot.img      # bootable image which may be flashed to a USB drive
./build/squashfs.img  # compressed userspace which can be uploaded to Swarm and booted
</code></pre>
<p>To boot your constructed image from Swarm, first you must store it to Swarm, retrieve its Swarm hash, add an entry to <code>./deboot.yaml</code>, then rebuild <code>boot.img</code>.</p>
<p>Once done, you can move to the next section to start DeBooting.</p>
<p>To clean after yourself, run:</p>
<pre><code class="language-sh">sudo make clean
</code></pre>
<h2 id="build-container">Build container</h2>
<p>The DeBoot build is designed to run in a Fedora container using the same set of package repositories as the appliance to be built and booted. The choice of Fedora is convenient, but not necessary: with suitable modifications to package names and paths, one could adjust the build to construct appliances based on their preferred distro.</p>
<p>To build and enter the build environment, make sure Podman is installed and run</p>
<pre><code>myhost:~/deboot$ sudo make init-env
...
buildenv:/$ cd /deboot
</code></pre>
<p>starting from the repo root.</p>
<h3 id="privileges">Privileges</h3>
<p>Certain build stages require mounting a filesystem, hence root privileges in the host. That means the build environment must be run as a <em>privileged</em> container invoked by the superuser. If that makes you uncomfortable, we recommend running the entire thing in a VM.</p>
<h3 id="version-consistency">Version consistency</h3>
<p>It is important that the initramfs and userspace use the same versions of packages. Crucially, the kernel modules installed in the initramfs and userspace must both exactly match the version of the loaded kernel; otherwise they cannot be loaded.</p>
<p>To ensure such consistency, the userspace and initramfs must be built using the same package repositories and at the same time as the build container. Unfortunately this means that the DeBoot POC boot image cannot easily</p>
<h2 id="layout">Layout</h2>
<p>The build processes for separate components are separated into different directories.</p>
<pre><code class="language-sh">/appliance/kiwi/ # rootfs builder
/initramfs/         # initramfs build scripts
           dracut/  # dracut fork used to build initramfs
/loader/        # configurations for kernel loaders
        grub/    # template for grub.cfg, BLS entries
        u-boot/  # template for extlinux.conf
# other directories either deprecated or irrelevant to the build
</code></pre>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../initramfs/" class="btn btn-neutral float-left" title="Initramfs"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../debooting/" class="btn btn-neutral float-right" title="DeBooting">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../initramfs/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../debooting/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
